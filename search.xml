<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Centos7-Lvm</title>
      <link href="/2025/03/14/Centos7-Lvm/"/>
      <url>/2025/03/14/Centos7-Lvm/</url>
      
        <content type="html"><![CDATA[<h1 id="Centos7-PVE-虚拟机磁盘扩容"><a href="#Centos7-PVE-虚拟机磁盘扩容" class="headerlink" title="Centos7-PVE 虚拟机磁盘扩容"></a>Centos7-PVE 虚拟机磁盘扩容</h1><h2 id="基础环境检查"><a href="#基础环境检查" class="headerlink" title="基础环境检查"></a>基础环境检查</h2><h3 id="磁盘空间"><a href="#磁盘空间" class="headerlink" title="磁盘空间"></a>磁盘空间</h3><p>总硬盘容量为20G，分配至根目录为17G<br><img src="https://www.chumq.cn:6081/app/hide.php?key=bVNnUmlzemZlZ3RITTc0dnhVMFZvZzJvMlVzajg5cGxJOE9RQWc9PQ==" alt="47e9fc6cdf8b14e83da8a847b08b2a7f.png"></p><h2 id="PVE配置"><a href="#PVE配置" class="headerlink" title="PVE配置"></a>PVE配置</h2><p><img src="https://www.chumq.cn:6081/app/hide.php?key=SUFNL0lDQko2YitqSjYxYk9jL0tIdzJvMlVzajg5cGxJOE9RQWc9PQ==" alt="08059f144535e8ee99467bf9c990335b.png"><br><img src="https://www.chumq.cn:6081/app/hide.php?key=Z2JwanA3YVVtcXBiUVVaVUtQQ25lUTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="7fe199ae4cca93bb09359f3803d6583a.png"><br><img src="https://www.chumq.cn:6081/app/hide.php?key=dmVFS2pVVDhVaTc3WjlmYVpjOXIxQTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="ebbc397b426f42ad7b18685b9c44be78.png"><br>扩容30G，使总容量至50G</p><p>重启前查看虚拟机磁盘情况<br><img src="https://www.chumq.cn:6081/app/hide.php?key=eVZKb3p5NEhtcGgwQldrSW5MYXVPZzJvMlVzajg5cGxJOE9RQWc9PQ==" alt="60954b7d1aedc483525e9a4cda3700f4.png"></p><p>重启虚拟机使配置生效</p><h2 id="扩容磁盘分配"><a href="#扩容磁盘分配" class="headerlink" title="扩容磁盘分配"></a>扩容磁盘分配</h2><h3 id="查看虚拟机当前磁盘情况"><a href="#查看虚拟机当前磁盘情况" class="headerlink" title="查看虚拟机当前磁盘情况"></a>查看虚拟机当前磁盘情况</h3><p><img src="https://www.chumq.cn:6081/app/hide.php?key=NFdkQms4RmZGbWx5MjIyNDA2czBLdzJvMlVzajg5cGxJOE9RQWc9PQ==" alt="05b70ab845bb073e8faa5dd42da39954.png"></p><h3 id="调整磁盘"><a href="#调整磁盘" class="headerlink" title="调整磁盘"></a>调整磁盘</h3><p>命令<code>fdisk /dev/sda</code><br><img src="https://www.chumq.cn:6081/app/hide.php?key=L2xOTWpYSXllTTZOdmpCVlAvOCtwUTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="74f07dc3a0ef66b6da202bf5d3fb22bd.png"></p><p><img src="https://www.chumq.cn:6081/app/hide.php?key=SHQvSzJwcFNVWkw2Tk1FNVNUb2poQTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="0d16bbea1ec931b103f97745b35e10ba.png"><br><img src="https://www.chumq.cn:6081/app/hide.php?key=WS9HMTFKcGd6S0M1RnRzTTgybjRLQTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="8444a87ea5725b85fc84793dea5f7e00.png"></p><p>根据最后的提示 The kernel still uses the old table. The new table will be used at<br>the next reboot or after you run partprobe(8) or kpartx(8) 让你重启虚机、建议直接重启即可<br><img src="https://www.chumq.cn:6081/app/hide.php?key=Q081eXJRU1lWU2JCNEcvSXNvc0cxZzJvMlVzajg5cGxJOE9RQWc9PQ==" alt="93fe8709f70b4630d2c2470fd2b164b3.png"></p><h3 id="格式化新磁盘"><a href="#格式化新磁盘" class="headerlink" title="格式化新磁盘"></a>格式化新磁盘</h3><p>通过 <code>lsblk -f</code> 查看分区的原先分区的文件系统类型为xfs，centos 7 使用的是xfs文件系统</p><p><img src="https://www.chumq.cn:6081/app/hide.php?key=czE4TDBNb2VrcXpJQktHN1R2TG9BdzJvMlVzajg5cGxJOE9RQWc9PQ==" alt="3318133dd28ee0be17d22d658d4b823c.png"></p><p>通过 <code>mkfs.xfs -f /dev/sda3</code> 格式化 sda3 分区</p><p><img src="https://www.chumq.cn:6081/app/hide.php?key=RW4raFRDQ3JTQ1YzMWFXeDF3WjN5QTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="0455e9e15378cb1eddb59c22777161e7.png"></p><h3 id="lvm实现卷扩容"><a href="#lvm实现卷扩容" class="headerlink" title="lvm实现卷扩容"></a>lvm实现卷扩容</h3><p>查看需要扩展的文件系统目录，df -h 查看目录链接为 &#x2F;dev&#x2F;mapper&#x2F;centos-root，或者 lvdisplay 查看目录为 &#x2F;dev&#x2F;centos_acme-cloudflare&#x2F;root</p><p><img src="https://www.chumq.cn:6081/app/hide.php?key=QWdEb1kxSnNWWW1xUjAyWWQ5SThpUTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="a1afffa3831e0f1014b5ea4f4bafbf88.png"></p><p>lvm 管理命令扩展指定卷</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lvm 进入 lvm 指令模式</span><br><span class="line">    vgdisplay</span><br><span class="line">        查看虚机卷组 （包含多个物理卷）我这里卷组为 centos，</span><br><span class="line">         </span><br><span class="line">    pvcreate /dev/sda3</span><br><span class="line">        初始化刚创建的分区为物理卷</span><br><span class="line">    </span><br><span class="line">    vgextend centos /dev/sda3  </span><br><span class="line">        将新创建的物理卷扩展到虚机卷组 </span><br><span class="line">        centos 为 卷组名称，可通过 vgdisplay 查看</span><br><span class="line">    </span><br><span class="line">    vgdisplay</span><br><span class="line">        记住 Free PE：如12800</span><br><span class="line"></span><br><span class="line">    lvextend -l +12800 /dev/mapper/centos-root</span><br><span class="line">        扩展已有文件系统逻辑卷的容量</span><br><span class="line">        lvextend 指令用于在线扩展逻辑卷的空间大小，而不中断应用程序对逻辑卷的访问。</span><br><span class="line">            -l: 指定逻辑卷要扩展大小，单位为PE数(如上面Free PE 的12800)</span><br><span class="line">            -L: 指定逻辑卷的大小，单位为Size(如K、M、G、T等）</span><br><span class="line">    quit</span><br><span class="line">        退出 lvm</span><br></pre></td></tr></table></figure><h3 id="vm-操作截图如下"><a href="#vm-操作截图如下" class="headerlink" title="vm 操作截图如下:"></a>vm 操作截图如下:</h3><ol><li>查看虚机卷组 （包含多个物理卷）我这里卷组为 查看扩展结果centos_acme-cloudflare<br>  <img src="https://www.chumq.cn:6081/app/hide.php?key=R3hkbzNUeUp3ampkZVl6WUFmUWYrQTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="3c1bd03891a10627c1b8aec42c593974.png"></li><li>初始化刚创建的分区为物理卷、将新创建的物理卷扩展到虚机卷组</li></ol><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lvm</span><br><span class="line">pvcreate /dev/sda3</span><br><span class="line">vgextend centos_acme-cloudflare /dev/sda3</span><br><span class="line">vgdisplay</span><br></pre></td></tr></table></figure><p><img src="https://www.chumq.cn:6081/app/hide.php?key=UCt0bVAvNmlZTmorSk5tdzA1VWdNdzJvMlVzajg5cGxJOE9RQWc9PQ==" alt="2a33de70c2277e0d917a61c7cc4db55b.png"><br>3. 扩展已有文件系统逻辑卷的容量</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lvextend -l +7679 /dev/mapper/centos_acme--cloudflare-root</span><br></pre></td></tr></table></figure><p><img src="https://www.chumq.cn:6081/app/hide.php?key=YVpZUE8yU0Z4dGR2ZDVMaVZhaWtxZzJvMlVzajg5cGxJOE9RQWc9PQ==" alt="7a5faa15a9cee4cdc802b6fc0f6c406d.png"><br>4. 查看扩展结果<br><img src="https://www.chumq.cn:6081/app/hide.php?key=MGRmYkpPSU5jQmZGQjFGbnBEMEN4QTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="b82e61165e7576eaf70384dbe412ead1.png"></p><h3 id="文件系统的扩容"><a href="#文件系统的扩容" class="headerlink" title="文件系统的扩容"></a>文件系统的扩容</h3><p>完成卷扩容，接下来做文件系统的扩容</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xfs_growfs /dev/mapper/centos_acme--cloudflare-root</span><br></pre></td></tr></table></figure><p><img src="https://www.chumq.cn:6081/app/hide.php?key=SjRkcVZXc3hFWDA5SCtzSERVVnZwUTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="0a83052ea7aabf5809d8eea5d9de81fb.png"><br><img src="https://www.chumq.cn:6081/app/hide.php?key=ZFltTmI3c0tPS2k1OHV6ZzJ4b3IvQTJvMlVzajg5cGxJOE9RQWc9PQ==" alt="17c7ba6192fc1db05b76d2b1aa7c85c3.png"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>EasyImage</title>
      <link href="/2025/03/12/EasyImage/"/>
      <url>/2025/03/12/EasyImage/</url>
      
        <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="基础环境检查"><a href="#基础环境检查" class="headerlink" title="基础环境检查"></a>基础环境检查</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker -v &amp;&amp; docker compose version</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir /root/data/docker_data/easyimage</span><br><span class="line">cd /root/data/docker_data/easyimage</span><br><span class="line">mkdir i &amp;&amp; mkdir config</span><br><span class="line">touch docker-compose.yml</span><br></pre></td></tr></table></figure><h3 id="docker-compose文件"><a href="#docker-compose文件" class="headerlink" title="docker-compose文件"></a>docker-compose文件</h3><figure class="highlight docker"><table><tr><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">    easyimage:</span><br><span class="line">        image: ddsderek/easyimage:latest</span><br><span class="line">        container_name: easyimage</span><br><span class="line">        ports:</span><br><span class="line">          - <span class="string">&#x27;8080:80&#x27;</span></span><br><span class="line">        environment:</span><br><span class="line">          - TZ=Asia/Shanghai</span><br><span class="line">          - PUID=<span class="number">1000</span></span><br><span class="line">          - PGID=<span class="number">1000</span></span><br><span class="line">        volumes:</span><br><span class="line">          - <span class="string">&#x27;./config:/app/web/config&#x27;</span></span><br><span class="line">          - <span class="string">&#x27;./i:/app/web/i&#x27;</span></span><br><span class="line">        restart: unless-stopped</span><br></pre></td></tr></table></figure><h3 id="检查文件"><a href="#检查文件" class="headerlink" title="检查文件"></a>检查文件</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat docker-compose.yaml</span><br></pre></td></tr></table></figure><p><img src="https://www.chumq.cn:6081/app/hide.php?key=aElSQjZUUlI5S3l5QllLZVczaHVWZFV5M0NNMEZreldMUjZ0L2c9PQ==" alt="c193109cd99611284aed264540d6aace.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker compoes up -d</span><br></pre></td></tr></table></figure><h2 id="初始化配置"><a href="#初始化配置" class="headerlink" title="初始化配置"></a>初始化配置</h2><h3 id="后台初始化"><a href="#后台初始化" class="headerlink" title="后台初始化"></a>后台初始化</h3><p>打开<code>http://IP:8080</code>，配置用户名和密码，并登陆后台<br><img src="https://www.chumq.cn:6081/app/hide.php?key=ZzJyMmxYQ2VBNGZIbnRUVHE2U0tEZFV5M0NNMEZreldMUjZ0L2c9PQ==" alt="8fab264bd551eb7ca093a1a31b983156.png"></p><h3 id="设置API"><a href="#设置API" class="headerlink" title="设置API"></a>设置API</h3><p><img src="https://www.chumq.cn:6081/app/hide.php?key=Tm9nNzZrZjRwb1lXcllFRCtIMUYrTlV5M0NNMEZreldMUjZ0L2c9PQ==" alt="476d2e5d746a97d2d98146695dc14ea5.png"></p><h3 id="安装picgo"><a href="#安装picgo" class="headerlink" title="安装picgo"></a>安装picgo</h3><h4 id="安装基础环境NODE-JS"><a href="#安装基础环境NODE-JS" class="headerlink" title="安装基础环境NODE.JS"></a>安装基础环境NODE.JS</h4><p><code>https://nodejs.org/zh-cn</code></p><h4 id="安装picgo-1"><a href="#安装picgo-1" class="headerlink" title="安装picgo"></a>安装picgo</h4><p><code>https://github.com/Molunerfinn/PicGo/releases</code><br><a href="https://github.com/Molunerfinn/PicGo/releases"><strong>点击下载</strong></a></p><h5 id="软件操作说明"><a href="#软件操作说明" class="headerlink" title="软件操作说明"></a>软件操作说明</h5><p><code>https://icret.github.io/EasyImages2.0/#/</code><br><a href="https://icret.github.io/EasyImages2.0/#/"><strong>点击查看</strong></a></p><h5 id="配置PICGO"><a href="#配置PICGO" class="headerlink" title="配置PICGO"></a>配置PICGO</h5><p><img src="https://www.chumq.cn:6081/app/hide.php?key=bHdPTnJWb1hLUlVZOCt0OFJTZ1VLZFV5M0NNMEZreldMUjZ0L2c9PQ==" alt="7041a4482c26c4c3bddbaa2a49937d86.png"> <img src="https://www.chumq.cn:6081/app/hide.php?key=Zi9tSENzRlFrblQySk14MytFeDkwOVV5M0NNMEZreldMUjZ0L2c9PQ==" alt="c0d40725e6156e326c9324cd4643dce3.png"><img src="https://www.chumq.cn:6081/app/hide.php?key=QkZPSlZpb3hPL09IWEdQbCtxNDUyZFV5M0NNMEZreldMUjZ0L2c9PQ==" alt="8ad57fe9c45a063c225dbab0100fad63.png"><img src="https://www.chumq.cn:6081/app/hide.php?key=SFgvTVIxZHpMQmlxcmlHMGg5NUlLdFV5M0NNMEZreldMUjZ0L2c9PQ==" alt="dc0b3c8e6db79913a961b52241c1d325.png"></p><blockquote><p>API地址:<code>https://png.cm/api/index.php</code> &#x2F;&#x2F; 输入你网站api地址<br>POST参数名: <code>image</code><br>JSON路径: <code>url</code><br>自定义Body: <code>&#123;&quot;token&quot;:&quot;1c17b11693cb5ec63859b091c5b9c1b2&quot;&#125;</code> &#x2F;&#x2F; 这里输入你网站生成的token</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker安装v2ray</title>
      <link href="/2025/02/21/v2ray/"/>
      <url>/2025/02/21/v2ray/</url>
      
        <content type="html"><![CDATA[<h2 id="安装说明"><a href="#安装说明" class="headerlink" title="安装说明"></a>安装说明</h2><p>Docker 镜像内集成了 V2Ray 内核，因此内核无需额外被安装。</p><p>Docker 是一个以服务生产环境而开发的应用平台，在使用 Docker 部署之时，我们相信你已经掌握了运维一台服务器所必须的知识，同时也理解了容器化的概念与 Docker 的基础操作。如若不然，请使用其它更加简单的部署方式。</p><p>以下命令假定你在 root 用户下操作，如果你所使用的用户不是 root，那么你可能需要 <code>sudo</code> 或 <code>doas</code> 命令来进行提权操作。</p><h2 id="方式一：始终使用最新版"><a href="#方式一：始终使用最新版" class="headerlink" title="方式一：始终使用最新版"></a>方式一：始终使用最新版</h2><h3 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker pull mzz2017/v2raya</span><br></pre></td></tr></table></figure><h3 id="运行-v2rayA"><a href="#运行-v2rayA" class="headerlink" title="运行 v2rayA"></a>运行 v2rayA</h3><p>停止正在运行的版本（如果存在）：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker container stop v2raya</span><br><span class="line">docker container rm v2raya</span><br></pre></td></tr></table></figure><p>运行 v2rayA:</p><ol><li><code>V2RAYA_V2RAY_BIN</code> 的值应当是 <code>/usr/local/bin/v2ray</code> 或 <code>/usr/local/bin/xray</code>，默认的核心是 xray。</li><li>如果你的宿主系统使用原生的 nftables，那么就把 <code>V2RAYA_NFTABLES_SUPPORT</code> 设置为 <code>on</code>。</li><li>如果你的宿主系统使用 iptables，那么可以通过 <code>IPTABLES_MODE</code> 变量来指定后端，将该变量的值设置为 <code>nftables</code> 将使用 nft 后端，设置为 <code>legacy</code> 将使用传统后端。</li></ol><p>以下是一个使用传统后端的示例：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --restart=always \</span><br><span class="line">  --privileged \</span><br><span class="line">  --network=host \</span><br><span class="line">  --name v2raya \</span><br><span class="line">  -e <span class="variable constant_">V2RAYA_LOG_FILE</span>=<span class="regexp">/tmp/</span>v2raya.<span class="property">log</span> \</span><br><span class="line">  -e <span class="variable constant_">V2RAYA_V2RAY_BIN</span>=<span class="regexp">/usr/</span>local/bin/v2ray \</span><br><span class="line">  -e <span class="variable constant_">V2RAYA_NFTABLES_SUPPORT</span>=off \</span><br><span class="line">  -e <span class="variable constant_">IPTABLES_MODE</span>=legacy \</span><br><span class="line">  -v /lib/<span class="attr">modules</span>:<span class="regexp">/lib/m</span><span class="attr">odules</span>:ro \</span><br><span class="line">  -v /etc/resolv.<span class="property">conf</span>:<span class="regexp">/etc/</span>resolv.<span class="property">conf</span> \</span><br><span class="line">  -v /etc/<span class="attr">v2raya</span>:<span class="regexp">/etc/</span>v2raya \</span><br><span class="line">  mzz2017/v2raya</span><br></pre></td></tr></table></figure><p>如果你使用 macOS 或其他不支持 host 模式的环境，在该情况下<strong>无法使用全局透明代理</strong>，或者你不希望使用全局透明代理，docker 命令会略有不同：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  -p <span class="number">2017</span>:<span class="number">2017</span> \</span><br><span class="line">  -p <span class="number">20170</span>-<span class="number">20172</span>:<span class="number">20170</span>-<span class="number">20172</span> \</span><br><span class="line">  --restart=always \</span><br><span class="line">  --name v2raya \</span><br><span class="line">  -e <span class="variable constant_">V2RAYA_V2RAY_BIN</span>=<span class="regexp">/usr/</span>local/bin/v2ray \</span><br><span class="line">  -e <span class="variable constant_">V2RAYA_LOG_FILE</span>=<span class="regexp">/tmp/</span>v2raya.<span class="property">log</span> \</span><br><span class="line">  -v /etc/<span class="attr">v2raya</span>:<span class="regexp">/etc/</span>v2raya \</span><br><span class="line">  mzz2017/v2raya</span><br></pre></td></tr></table></figure><p>查看状态：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker container stats v2raya</span><br></pre></td></tr></table></figure><h2 id="方式二：获取指定版本"><a href="#方式二：获取指定版本" class="headerlink" title="方式二：获取指定版本"></a>方式二：获取指定版本</h2><p>Docker 允许用户同时下载不同版本的 v2rayA。通过错开端口等操作，用户还可以运行多个不同版本的 v2rayA。</p><h3 id="获取镜像-1"><a href="#获取镜像-1" class="headerlink" title="获取镜像"></a>获取镜像</h3><p>获取最新的版本号：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Latest</span>_version=$(curl -L <span class="string">&quot;https://api.github.com/repos/v2rayA/v2rayA/releases/latest&quot;</span> | grep <span class="string">&#x27;tag_name&#x27;</span> | awk -F <span class="string">&#x27;&quot;&#x27;</span> <span class="string">&#x27;&#123;print $4&#125;&#x27;</span> | awk -F <span class="string">&#x27;v&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">echo $Latest_version</span><br></pre></td></tr></table></figure><p>如果你不需要最新的版本，你也可以访问 <a href="https://hub.docker.com/r/mzz2017/v2raya/tags">Docker 镜像仓库</a> 查找所需的版本。比如，你需要 1.5.8 版本，那么将 <code>$Latest_version</code> 替换为你所需的版本即可。</p><p>获取 Docker 镜像：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker pull mzz2017/<span class="attr">v2raya</span>:$Latest_version</span><br></pre></td></tr></table></figure><h3 id="运行-v2rayA-1"><a href="#运行-v2rayA-1" class="headerlink" title="运行 v2rayA"></a>运行 v2rayA</h3><p>使用 docker 运行 v2rayA:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --restart=always \</span><br><span class="line">  --privileged \</span><br><span class="line">  --network=host \</span><br><span class="line">  --name v2raya \</span><br><span class="line">  -e <span class="variable constant_">V2RAYA_LOG_FILE</span>=<span class="regexp">/tmp/</span>v2raya.<span class="property">log</span> \</span><br><span class="line">  -e <span class="variable constant_">V2RAYA_V2RAY_BIN</span>=<span class="regexp">/usr/</span>local/bin/v2ray \</span><br><span class="line">  -e <span class="variable constant_">V2RAYA_NFTABLES_SUPPORT</span>=off \</span><br><span class="line">  -e <span class="variable constant_">IPTABLES_MODE</span>=legacy \</span><br><span class="line">  -v /lib/<span class="attr">modules</span>:<span class="regexp">/lib/m</span><span class="attr">odules</span>:ro \</span><br><span class="line">  -v /etc/resolv.<span class="property">conf</span>:<span class="regexp">/etc/</span>resolv.<span class="property">conf</span> \</span><br><span class="line">  -v /etc/<span class="attr">v2raya</span>:<span class="regexp">/etc/</span>v2raya \</span><br><span class="line">  mzz2017/<span class="attr">v2raya</span>:$Latest_version</span><br></pre></td></tr></table></figure><p>如果你使用 MacOSX 或其他不支持 host 模式的环境，在该情况下<strong>无法使用全局透明代理</strong>，或者你不希望使用全局透明代理，docker 命令会略有不同：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  -p <span class="number">2017</span>:<span class="number">2017</span> \</span><br><span class="line">  -p <span class="number">20170</span>-<span class="number">20172</span>:<span class="number">20170</span>-<span class="number">20172</span> \</span><br><span class="line">  --restart=always \</span><br><span class="line">  --name v2raya \</span><br><span class="line">  -e <span class="variable constant_">V2RAYA_LOG_FILE</span>=<span class="regexp">/tmp/</span>v2raya.<span class="property">log</span> \</span><br><span class="line">  -v /etc/<span class="attr">v2raya</span>:<span class="regexp">/etc/</span>v2raya \</span><br><span class="line">  mzz2017/<span class="attr">v2raya</span>:$Latest_version</span><br></pre></td></tr></table></figure><p>查看状态：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker container stats v2raya</span><br></pre></td></tr></table></figure><h3 id="更新-v2rayA"><a href="#更新-v2rayA" class="headerlink" title="更新 v2rayA"></a>更新 v2rayA</h3><p>使用 <a href="#%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F">获取镜像</a> 中所提到的命令获取最新版本的镜像，然后停止当前容器：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker container stop v2raya</span><br><span class="line">docker container rm v2raya</span><br></pre></td></tr></table></figure><p>最后使用 <a href="#%E8%BF%90%E8%A1%8C-v2raya">运行 v2rayA</a> 里面所提到的命令运行新版本 v2rayA。更新 v2rayA 之后，你可以考虑删除旧版本镜像。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>使用Acme.sh脚本申请证书</title>
      <link href="/2025/02/21/%E4%BD%BF%E7%94%A8Acme.sh%E8%84%9A%E6%9C%AC%E7%94%B3%E8%AF%B7%E8%AF%81%E4%B9%A6/"/>
      <url>/2025/02/21/%E4%BD%BF%E7%94%A8Acme.sh%E8%84%9A%E6%9C%AC%E7%94%B3%E8%AF%B7%E8%AF%81%E4%B9%A6/</url>
      
        <content type="html"><![CDATA[<p><a href="https://image.rwrl.net/acme/2024-05-10-20-48-38.png"><img src="https://image.rwrl.net/acme/2024-05-10-20-48-38.png"></a></p><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>由于腾讯云也在4月底宣布将ssl证书改为90天的有效期，所以使用它的证书就不如使用acme.sh脚本来申请的证书方便，这个脚本呢，自动申请，自动续期，确实方便不少。</p><p>这里我只讲使用api令牌的方式进行申请，快而且其他的相对方便一些。打开下面的链接即可查看如何获取api密钥的方法。</p><p><a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi">https://github.com/acmesh-official/acme.sh/wiki/dnsapi</a></p><h3 id="本次演示域名托管在cloudflare"><a href="#本次演示域名托管在cloudflare" class="headerlink" title="本次演示域名托管在cloudflare"></a>本次演示域名托管在cloudflare</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt update   ##更新系统</span><br><span class="line">apt install -y socat</span><br><span class="line">wget -O -  https://get.acme.sh | sh -s email=ytb0324@outlook.com    ##更换自己的邮箱，接收有用的信息</span><br><span class="line">alias acme.sh=~/.acme.sh/acme.sh</span><br><span class="line">acme.sh --set-default-ca --server letsencrypt     ###默认的zero ssl证书，更换证书提供商</span><br><span class="line">export CF_Token=&quot;Sm_iU9EbM909bNbK67vyimaO38hCOhoGGc8fGm1B&quot;</span><br><span class="line">export CF_Zone_ID=&quot;235f185aab91647bc1eb3fb4c0f76969&quot;</span><br><span class="line">acme.sh --issue --dns dns_cf -d &#x27;042176.xyz&#x27; -d &#x27;*.042176.xyz&#x27;     ###这里申请的是主域名以及泛域名</span><br><span class="line"></span><br><span class="line">###安装证书到指定的文件夹</span><br><span class="line">mkdir /root/xxx   #创建一个文件夹</span><br><span class="line">acme.sh --install-cert -d &#x27;042176.xyz&#x27; -d &#x27;*.042176.xyz&#x27; \</span><br><span class="line">--key-file       /root/xxx/042176.xyz.key  \</span><br><span class="line">--fullchain-file /root/xxx/042176.xyz.crt \</span><br><span class="line">--reloadcmd     &quot;service nginx force-reload&quot;</span><br><span class="line"></span><br><span class="line">chmod -R 755 /root/xxx      ###赋予权限</span><br><span class="line"></span><br><span class="line">acme.sh --upgrade --auto-upgrade    ###自动升级脚本</span><br></pre></td></tr></table></figure><h4 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h4><p>这个脚本在国内的服务器有不定时抽搐，提示超时连接不上导致申请失败，所以在申请的时候需要在不同时段多尝试几次即可。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 安装docker compose 教程</title>
      <link href="/2025/02/21/%E6%95%99%E7%A8%8B/"/>
      <url>/2025/02/21/%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="CentOS-7-安装-docker-compose-教程"><a href="#CentOS-7-安装-docker-compose-教程" class="headerlink" title="CentOS 7 安装 docker compose 教程"></a>CentOS 7 安装 docker compose 教程</h3><p><img src="https://www.chumq.cn:6081/i/0/2025/02/27/io8jyn-0.png"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>正在折腾测试些<a href="https://cloud.tencent.com/product/tke?from_column=20065&from=20065">docker</a><a href="https://cloud.tencent.com/product/tke?from_column=20065&from=20065">容器</a>,用到docker compose功能,记录一下安装流程. CentOS 7 上Docker的安装方法参考:<br>本文为 <a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://www.ioiox.com/stille.html&objectId=1855291&objectType=1&isNewArticle=undefined">Stille</a> 原创文章.经实践,测试,整理发布.如需转载请联系作者获得授权,并注明转载地址.</p><hr><h3 id="三种安装方法"><a href="#三种安装方法" class="headerlink" title="三种安装方法"></a>三种安装方法</h3><ol><li>官方安装 - 速度慢,有可能被DNS污染导致失败.</li><li>手动安装 - 手动下载,离线安装.</li><li>PIP在线安装 - 使用Python的PIP包管理工具在线安装</li></ol><h4 id="官方安装"><a href="#官方安装" class="headerlink" title="官方安装"></a>官方安装</h4><p>官网选择版本 <a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://github.com/docker/compose/releases&objectId=1855291&objectType=1&isNewArticle=undefined">https://github.com/docker/compose/releases</a> <strong>以下命令手动修改版本号,例如<code>1.24.1</code></strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">curl -L <span class="attr">https</span>:<span class="comment">//github.com/docker/compose/releases/download/2.33.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span></span><br></pre></td></tr></table></figure><p>添加执行权限</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><p>检查docker compose版本</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker-compose version</span><br></pre></td></tr></table></figure><h4 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h4><p>官网选择版本 <a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://github.com/docker/compose/releases&objectId=1855291&objectType=1&isNewArticle=undefined">https://github.com/docker/compose/releases</a> 选择相应版本,下载docker-compose-Linux-x86_64到本地或者<a href="https://cloud.tencent.com/product/cvm/?from_column=20065&from=20065">服务器</a>中 更名为<code>docker-compose</code>,并移动到 &#x2F;usr&#x2F;local&#x2F;bin 目录下 添加执行权限</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><p>检查docker compose版本</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker-compose version</span><br></pre></td></tr></table></figure><h4 id="PIP在线安装"><a href="#PIP在线安装" class="headerlink" title="PIP在线安装"></a>PIP在线安装</h4><p>安装依赖</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">yum -y install epel-release</span><br></pre></td></tr></table></figure><p>安装PIP</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">yum -y install python-pip</span><br></pre></td></tr></table></figure><p>升级PIP</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">pip install --upgrade pip</span><br></pre></td></tr></table></figure><p>检查PIP版本</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">pip --version</span><br><span class="line">&gt;pip <span class="number">19.3</span><span class="number">.1</span> <span class="keyword">from</span> /usr/lib/python2<span class="number">.7</span>/site-packages/<span class="title function_">pip</span> (python <span class="number">2.7</span>)</span><br></pre></td></tr></table></figure><p>安装docker compose,自行更改版本号.</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">pip install -U docker-compose==<span class="number">1.24</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><p>检查docker compose版本</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">docker-compose version</span><br></pre></td></tr></table></figure><p>如果使用PIP安装时报以下错误,先升级安装requests库.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">`ERROR: Cannot uninstall <span class="string">&#x27;requests&#x27;</span>. It is a distutils installed project and thus we cannot accurately determine <span class="built_in">which</span> files belong to it <span class="built_in">which</span> would lead to only a partial uninstall.`</span><br></pre></td></tr></table></figure><p>升级安装requests库</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">pip install -I requests==<span class="number">2.10</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><p>再次安装docker compose</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">pip install -U docker-compose==<span class="number">1.24</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
